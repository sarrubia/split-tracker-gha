import { forOwn } from '../../utils/lang';
import { submitterSyncTaskFactory } from './submitterSyncTask';
// extract POST payload object from cache
function fromCache(propertyName) {
    return function (data) {
        var result = [];
        forOwn(data, function (value, key) {
            var _a;
            result.push((_a = { name: key }, _a[propertyName] = value, _a));
        });
        return result;
    };
}
/**
 * Sync task that periodically posts telemetry counts
 */
export function countsSyncTaskFactory(log, postMetricsCounters, countsCache, metricsRefreshRate, latencyTracker) {
    return submitterSyncTaskFactory(log, postMetricsCounters, countsCache, metricsRefreshRate, 'count metrics', latencyTracker, fromCache('delta'));
}
/**
 * Sync task that periodically posts telemetry latencies
 */
export function latenciesSyncTaskFactory(log, postMetricsLatencies, latenciesCache, metricsRefreshRate, latencyTracker) {
    // don't retry metrics.
    return submitterSyncTaskFactory(log, postMetricsLatencies, latenciesCache, metricsRefreshRate, 'latency metrics', latencyTracker, fromCache('latencies'), 0, true);
}
