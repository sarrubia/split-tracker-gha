"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.latenciesSyncTaskFactory = exports.countsSyncTaskFactory = void 0;
var lang_1 = require("../../utils/lang");
var submitterSyncTask_1 = require("./submitterSyncTask");
// extract POST payload object from cache
function fromCache(propertyName) {
    return function (data) {
        var result = [];
        (0, lang_1.forOwn)(data, function (value, key) {
            var _a;
            result.push((_a = { name: key }, _a[propertyName] = value, _a));
        });
        return result;
    };
}
/**
 * Sync task that periodically posts telemetry counts
 */
function countsSyncTaskFactory(log, postMetricsCounters, countsCache, metricsRefreshRate, latencyTracker) {
    return (0, submitterSyncTask_1.submitterSyncTaskFactory)(log, postMetricsCounters, countsCache, metricsRefreshRate, 'count metrics', latencyTracker, fromCache('delta'));
}
exports.countsSyncTaskFactory = countsSyncTaskFactory;
/**
 * Sync task that periodically posts telemetry latencies
 */
function latenciesSyncTaskFactory(log, postMetricsLatencies, latenciesCache, metricsRefreshRate, latencyTracker) {
    // don't retry metrics.
    return (0, submitterSyncTask_1.submitterSyncTaskFactory)(log, postMetricsLatencies, latenciesCache, metricsRefreshRate, 'latency metrics', latencyTracker, fromCache('latencies'), 0, true);
}
exports.latenciesSyncTaskFactory = latenciesSyncTaskFactory;
